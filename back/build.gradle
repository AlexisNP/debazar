/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'java'
    id 'maven-publish'

    id 'war'

    id 'eclipse'

    id 'jacoco'

    id 'checkstyle'

    id "com.github.spotbugs" version "3.0.0"

    id 'pmd'

    id 'de.aaschmid.cpd' version '3.1'

    id "se.bjurr.violations.violations-gradle-plugin" version "1.40"
}

repositories {
    mavenLocal()
    maven {
        url = uri('https://repo.maven.apache.org/maven2')
    }
}

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-data-jdbc:2.2.5.RELEASE'
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa:2.2.5.RELEASE'
    implementation 'org.springframework.boot:spring-boot-starter-data-rest:2.2.5.RELEASE'
    implementation 'org.springframework.boot:spring-boot-starter-integration:2.2.5.RELEASE'
    implementation 'org.springframework.boot:spring-boot-starter-jdbc:2.2.5.RELEASE'
    implementation 'org.springframework.boot:spring-boot-starter-mail:2.2.5.RELEASE'
    implementation 'org.springframework.boot:spring-boot-starter-security:2.2.5.RELEASE'
    implementation 'org.springframework.boot:spring-boot-starter-web:2.2.5.RELEASE'
    implementation 'org.springframework.boot:spring-boot-starter-web-services:2.2.5.RELEASE'
    implementation 'org.springframework.boot:spring-boot-configuration-processor:2.2.5.RELEASE'
    implementation 'org.projectlombok:lombok:1.18.12'
    runtimeOnly 'org.springframework.boot:spring-boot-devtools:2.2.5.RELEASE'
    runtimeOnly 'mysql:mysql-connector-java:8.0.19'
    runtimeOnly 'org.hsqldb:hsqldb:2.5.0'
    testImplementation 'org.springframework.boot:spring-boot-starter-test:2.2.5.RELEASE'
    testImplementation 'org.springframework.integration:spring-integration-test:5.2.4.RELEASE'
    testImplementation 'org.springframework.restdocs:spring-restdocs-mockmvc:2.0.4.RELEASE'
    testImplementation 'org.springframework.security:spring-security-test:5.2.2.RELEASE'
    providedCompile 'org.springframework.boot:spring-boot-starter-tomcat:2.2.5.RELEASE'
}

group = 'fr.mds'
version = '0.0.1-SNAPSHOT'
description = 'debazar'
sourceCompatibility = '1.8'

publishing {
    publications {
        maven(MavenPublication) {
            from(components.java)
        }
    }
}

tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
}

test {
    // Use junit platform for unit tests
    useJUnitPlatform()
}

task checkstyleMain (type: Checkstyle, overwrite: true) {
    ignoreFailures = true
    showViolations = false
}

task checkstyleTest (type: Checkstyle, overwrite: true){
    ignoreFailures = true
    showViolations = false
}

tasks.withType(com.github.spotbugs.SpotBugsTask) {
  ignoreFailures = true
}

task pmdMain(type: Pmd, overwrite: true) {
  ignoreFailures = true
}

task pmdTest(type: Pmd, overwrite: true) {
  ignoreFailures = true
}

cpdCheck {
  ignoreFailures = true
  reports {
    text.enabled = true
    xml.enabled = true
  }
  source = sourceSets.main.allJava
  minimumTokenCount = 50
}

task violations(type: se.bjurr.violations.gradle.plugin.ViolationsTask) {
   //
   // Optional config
   //
   maxReporterColumnWidth = 0 // 0 means "no limit"
   maxRuleColumnWidth = 60
   maxSeverityColumnWidth = 0
   maxLineColumnWidth = 0
   maxMessageColumnWidth = 50
   codeClimateFile = file('code-climate-file.json') // Will create a CodeClimate JSON report.
   violationsFile = file('violations-file.json') // Will create a normalized JSON report.


   //
   // Global configuration, remove if you dont want to report violations for
   // the entire repo.
   //
   minSeverity = 'INFO' // INFO, WARN or ERROR
   detailLevel = 'VERBOSE' // PER_FILE_COMPACT, COMPACT or VERBOSE
   maxViolations = 99999999 // Will fail the build if total number of found violations is higher
   printViolations = true // Will print violations found in diff


   //
   // Diff configuration, remove if you dont want to report violations for
   // files changed between specific revisions.
   //
   // diff-properties can be supplied with something like:
   //
   // ./gradlew violations -PdiffFrom=e4de20e -PdiffTo=HEAD
   //
   // And in Travis, you could add:
   //
   //  script:
   //   - 'if [ "$TRAVIS_PULL_REQUEST" != "false" ]; then bash ./gradlew check -PdiffFrom=$TRAVIS_PULL_REQUEST_BRANCH -PdiffTo=$TRAVIS_BRANCH ; fi'
   //
   diffFrom = project.properties.diffFrom // Can be empty (ignored), Git-commit or any Git-reference
   diffTo = project.properties.diffTo // Same as above
   diffMinSeverity = 'INFO' // INFO, WARN or ERROR
   diffDetailLevel = 'VERBOSE' // PER_FILE_COMPACT, COMPACT or VERBOSE
   diffMaxViolations = 99 // Will fail the build if number of violations, in the diff within from/to, is higher
   diffPrintViolations = true // Will print violations found in diff
   gitRepo = file('.') // Where to look for Git


   //
   // This is mandatory regardless of if you want to report violations between
   // revisions or the entire repo.
   //
   // Many more formats available, see: https://github.com/tomasbjerre/violations-lib
   violations = [
      ["FINDBUGS",   projectDir.path + "/build/reports/", ".*/findbugs/.*\\.xml\$",   "Findbugs"],
      ["PMD",        projectDir.path + "/build/reports/", ".*/pmd/.*\\.xml\$",        "PMD"],
      ["CHECKSTYLE", projectDir.path + "/build/reports/", ".*/checkstyle/.*\\.xml\$", "Checkstyle"],
      ["CPD", projectDir.path + "/build/reports/", ".*/cpd/.*\\.xml\$", "Cpd"],
   ]
}

check.finalizedBy violations
